<!DOCTYPE html>
<html lang="ja">

<head>

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>旅の出費入力</title>

        <style>
            body {
                margin: 0;
                padding: 0;
                font-family: "Hiragino Maru Gothic ProN", "Yu Gothic", sans-serif;
                background: linear-gradient(135deg, #ff9ecf, #ff66b2, #ffb3e6);
                background-size: 400% 400%;
                animation: bgMove 10s ease infinite;
            }

            @keyframes bgMove {
                0% {
                    background-position: 0% 50%;
                }

                50% {
                    background-position: 100% 50%;
                }

                100% {
                    background-position: 0% 50%;
                }
            }

            .book {
                max-width: 500px;
                margin: 40px auto;
                padding: 30px;
                background: white;
                border-radius: 20px;
                box-shadow: 0 0 40px rgba(255, 105, 180, 0.6);
                border: 5px solid #ff66b2;
            }

            h1 {
                text-align: center;
                color: #ff1493;
                text-shadow: 2px 2px 0 #fff, 4px 4px 8px rgba(255, 105, 180, 0.5);
                margin-bottom: 20px;
            }

            /* 入力エリア */
            .form-area {
                display: flex;
                gap: 15px;
            }

            /* スマホ時は縦並び */
            @media (max-width: 600px) {
                .form-area {
                    flex-direction: column;
                }

                .book {
                    max-width: 100%;
                    margin: 20px;
                    padding: 20px;
                }
            }

            input {
                width: 100%;
                padding: 12px;
                border-radius: 15px;
                border: 2px solid #ff66b2;
                font-size: 16px;
                box-sizing: border-box;
                /* ← これ追加 */
            }

            /* ボタン */
            button {
                margin-top: 20px;
                width: 100%;
                padding: 12px;
                border-radius: 25px;
                border: none;
                background: linear-gradient(to right, #ff66b2, #ff1493);
                color: white;
                font-weight: bold;
                font-size: 18px;
                box-shadow: 0 4px 10px rgba(255, 105, 180, 0.4);
                cursor: pointer;
                transition: 0.3s;
            }

            button:hover {
                transform: scale(1.05);
                background: linear-gradient(to right, #ff1493, #ff66b2);
            }

            .result {
                margin-top: 15px;
                text-align: center;
                font-weight: bold;
                color: #ff1493;
            }

            .list-item {
                background: linear-gradient(to right, #ffe6f5, #ffffff);
                border-radius: 20px;
                padding: 12px 18px;
                margin: 10px 0;
                box-shadow: 0 4px 10px rgba(255, 105, 180, 0.3);
                display: flex;
                justify-content: space-between;
                align-items: center;
                font-weight: bold;
                color: #ff1493;
            }

            #total {
                margin-top: 20px;
                font-size: 22px;
                font-weight: bold;
                text-align: right;
                color: #ff1493;
                background: #ffe6f5;
                padding: 15px;
                border-radius: 20px;
                box-shadow: 0 4px 10px rgba(255, 105, 180, 0.3);
            }

            #message {
                text-align: center;
                color: #ff1493;
                font-weight: bold;
                margin-top: 10px;
                opacity: 0;
                transition: opacity 1s;
            }

            .delete-btn {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                border: none;
                background: linear-gradient(to right, #ff66b2, #ff1493);
                color: white;
                font-size: 20px;
                font-weight: bold;
                cursor: pointer;
                box-shadow: 0 3px 8px rgba(255, 105, 180, 0.4);

                display: flex;
                align-items: center;
                /* 縦中央 */
                justify-content: center;
                /* 横中央 */

                padding: 0;
                /* 念のため */
                line-height: 1;
                /* 念のため */
            }

            .loader {
                width: 24px;
                height: 24px;
                border: 3px solid #ffd6f0;
                border-top: 3px solid #ff1493;
                border-radius: 50%;
                animation: spin 1s linear infinite;
                margin-left: 10px;
            }

            @keyframes spin {
                0% {
                    transform: rotate(0deg);
                }

                100% {
                    transform: rotate(360deg);
                }
            }
        </style>
    </head>

<body>
    <div class="book">
        <h1>旅の出費入力</h1>

        <div class="form-area">
            <input type="text" id="title" placeholder="件名（例：新幹線代）">
            <input type="number" id="price" placeholder="金額（例：15000）">
        </div>

        <button onclick="sendData()">追加する</button>
        <div id="message"></div>

        <div id="loading" class="result">ロード中</div>
        <div id="list"></div>
        <div id="total" class="result"></div>

        <div class="result" id="result"></div>
    </div>

    <script>
        const url = "https://script.google.com/macros/s/AKfycbxUsjw4q_2GilWJbXqflusDYwEq_srPQE9hZ_wNqcLrqunENfbd8_ZGKUkuLEH-zInELg/exec"; // GASのURL

        function sendData() {
            const title = document.getElementById("title").value;
            const price = document.getElementById("price").value;

            if (!title || !price) {
                alert("件名と金額を入力してください");
                return;
            }

            fetch(url, {
                method: "POST",
                body: new URLSearchParams({
                    title: title,
                    price: price
                })
            })
                .then(() => {
                    document.getElementById("title").value = "";
                    document.getElementById("price").value = "";
                    showMessage("追加しました！");
                    loadData();
                });
        }

        function loadData() {
            const loading = document.getElementById("loading");
            loading.style.display = "block";

            dotCount = 0;
            loadingTimer = setInterval(() => {
                dotCount = (dotCount + 1) % 4;
                loading.innerText = "ロード中" + ".".repeat(dotCount);
            }, 500);

            fetch(url)
                .then(res => res.json())
                .then(data => {
                    clearInterval(loadingTimer);
                    loading.style.display = "none";

                    let html = "";
                    let total = 0;

                    data.forEach((row, index) => {
                        const item = row[0];
                        const price = Number(row[1]);

                        if (!item || !price) return;

                        html += `
                  <div class="list-item">
                    <div>
                      <div>${item}</div>
                      <div>${price.toLocaleString()}円</div>
                    </div>
                    <button class="delete-btn" onclick="deleteRow(${index + 2})">×</button>
                  </div>
                `;

                        total += price;
                    });

                    document.getElementById("list").innerHTML = html;
                    document.getElementById("total").innerText =
                        "合計： " + total.toLocaleString() + " 円";
                });
        }

        function deleteRow(index, btn) {
            // ボタンを消してローダー表示
            btn.style.display = "none";
            const loader = document.createElement("div");
            loader.className = "loader";
            btn.parentElement.appendChild(loader);

            fetch(url, {
                method: "POST",
                body: new URLSearchParams({
                    mode: "delete",
                    index: index
                })
            }).then(() => {
                loadData();
            });
        }

        function showMessage(text) {
            const msg = document.getElementById("message");
            msg.innerText = text;
            msg.style.opacity = 1;

            setTimeout(() => {
                msg.style.opacity = 0;
            }, 3000);
        }

        // 最初に読み込む
        loadData();
    </script>
</body>

</html>
